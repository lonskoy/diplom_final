#### Бэк энд структура ####

- src
  - auth 
    - guards
    - strategy
  - chat
  - chatOnline
  - core 
    - enviroment
  - hotel
  - hotel-room
  - reservation
  - users

### Назначение модулей ###

## Модуль auth ##
**Общее описание** - данный модуль отвечает за политику разделения прав доступа по 3 типам пользователей *клиент*, *менеджер*, *администратор*, а так же за логирование и разлогирование пользователя.

**Стратегии** - src\auth\strategy содержит стратегии для разрешения доступа согласно правам клиент, менеджер админ. Все стратегии работают идентично - получаем токен из куки файла, ищем пользователя по id в базе и определяем его role. Если role подходит то выполнение запроса будет продолжено.

**Функции :** 
**validateUser** (email, password) - передает данные в *usersService.checkUser* и проводит проверку на корректность введеных данных.
**login** ({user}) - принимает объект, на основе полей id, role, name формирует объект и зашифровыывет его в токен. Возвращает токен.
**logout** - очищает токен в куки файле и возвращает на стартовую страницу 

**Роуты :**
**api/auth/login** - залогиниться
**api/auth/logout** - разлогиниться

 

client.controller.ts

Этот файл содержит контроллеры для клиентской части приложения. Он обрабатывает запросы, связанные с регистрацией клиентов, поиском комнат, управлением запросами поддержки и другими операциями, доступными для клиентов.

Импорты

@nestjs/common — декораторы и классы для создания контроллеров и обработки HTTP-запросов.

RegisterDto — DTO (Data Transfer Object) для регистрации клиента.

ClientService — сервис для обработки бизнес-логики, связанной с клиентами.

Response и Request — для работы с HTTP-ответами и запросами.

FindRoomsOnData — DTO для поиска комнат по данным.

SupportRequestClientService — сервис для работы с запросами поддержки.

CreateSupportRequestDto — DTO для создания запроса поддержки.

AuthGuard — гвард для аутентификации клиентов.

Методы

create — обрабатывает запрос на регистрацию клиента. Если пользователь уже авторизован, выбрасывается исключение ForbiddenException.

getAllRooms — возвращает список всех комнат.

findRoomOnData — поиск комнат по заданным параметрам (например, даты бронирования).

findRoomById — поиск комнаты по её идентификатору.

createSupportRequest — создание запроса поддержки. Доступно только для авторизованных клиентов.

findSupportRequests — получение списка запросов поддержки для текущего клиента.

markMessagesAsRead — отметка сообщений в запросе поддержки как прочитанных.

client.service.ts

Этот файл содержит сервис для обработки бизнес-логики, связанной с клиентами. Он взаимодействует с базой данных через Mongoose и предоставляет методы для регистрации клиентов, поиска комнат и других операций.

Импорты

@nestjs/common — декораторы и классы для создания сервисов.

InjectModel — для внедрения моделей Mongoose.

Model — интерфейс для работы с моделями Mongoose.

User, HotelRoom, Reservation — модели Mongoose для пользователей, комнат и бронирований.

bcrypt — для хэширования паролей.

RegisterDto — DTO для регистрации клиента.

JwtService — для генерации JWT-токенов.

cookie — для работы с куками.

Response — для работы с HTTP-ответами.

FindRoomsOnData — DTO для поиска комнат по данным.

Методы

create — регистрирует нового клиента, хэширует пароль, генерирует JWT-токен и устанавливает его в куки.

allRooms — возвращает список всех комнат с информацией о связанных отелях.

findRoomsOnData — поиск доступных комнат на основе дат бронирования.

findRoomById — поиск комнаты по её идентификатору.

manager.controller.ts

Этот файл содержит контроллеры для менеджеров. Он обрабатывает запросы, связанные с управлением пользователями.

Импорты

@nestjs/common — декораторы и классы для создания контроллеров.

User — модель Mongoose для пользователей.

ManagerService — сервис для обработки бизнес-логики, связанной с менеджерами.

AuthGuard — гвард для аутентификации менеджеров.

SearchUserParams — интерфейс для параметров поиска пользователей.

Методы

findAllManager — возвращает список всех пользователей. Доступно только для авторизованных менеджеров.

manager.service.ts

Этот файл содержит сервис для обработки бизнес-логики, связанной с менеджерами. Он предоставляет методы для работы с пользователями.

Импорты

@nestjs/common — декораторы и классы для создания сервисов.

InjectModel — для внедрения моделей Mongoose.

Model — интерфейс для работы с моделями Mongoose.

User — модель Mongoose для пользователей.

Методы

findAll — возвращает список всех пользователей с фильтрацией по определённым полям (id, email, name, contactPhone).

users.controller.ts

Этот файл содержит контроллеры для администраторов. Он обрабатывает запросы, связанные с управлением пользователями (создание, поиск, удаление).

Импорты

@nestjs/common — декораторы и классы для создания контроллеров.

User — модель Mongoose для пользователей.

UsersService — сервис для обработки бизнес-логики, связанной с пользователями.

AuthGuard — гвард для аутентификации администраторов.

CreateUserDto — DTO для создания пользователя.

SearchUserParams — интерфейс для параметров поиска пользователей.

Методы

createUser — создание нового пользователя. Доступно только для администраторов.

findAllUser — возвращает список всех пользователей с возможностью фильтрации.

findByIdUser — поиск пользователя по идентификатору.

findByEmailUser — поиск пользователя по email.

removeUser — удаление пользователя по идентификатору.

users.module.ts

Этот файл определяет модуль UsersModule, который объединяет контроллеры, сервисы и модели, связанные с пользователями, клиентами и менеджерами.

Импорты

Module — декоратор для создания модулей в NestJS.

UsersService, ClientService, ManagerService — сервисы для работы с пользователями, клиентами и менеджерами.

UsersController, ManagerController, ClientController — контроллеры для обработки запросов.

MongooseModule — для работы с моделями Mongoose.

User, HotelRoom, Reservation, SupportRequest — модели Mongoose.

JwtModule — для работы с JWT-токенами.

SupportRequestClientService, SupportRequestService — сервисы для работы с запросами поддержки.

Настройки

Модуль регистрирует модели Mongoose для пользователей, комнат, бронирований и запросов поддержки.

Настраивает JWT-модуль для генерации токенов.

Экспортирует UsersService для использования в других модулях.

